---
layout: post
tags: [spring, redis]
---

> 이 문서는 가리사니 개발자 포럼에 올렸던 글의 백업 파일입니다.
오래된 문서가 많아 현재 상황과 맞지 않을 수 있습니다.


# 스프링 부트 세션 시리즈
- [1. 스프링 부트 레디스 세션 연동](/2016/07/20/%EB%B0%B1%EC%97%85-%EA%B0%80%EB%A6%AC%EC%82%AC%EB%8B%88-%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-%EB%A0%88%EB%94%94%EC%8A%A4-%EC%84%B8%EC%85%98-%EC%97%B0%EB%8F%99.html)
- [2. 스프링 부트 세션 스코프빈](/2016/07/20/%EB%B0%B1%EC%97%85-%EA%B0%80%EB%A6%AC%EC%82%AC%EB%8B%88-%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-%EC%84%B8%EC%85%98-%EC%8A%A4%EC%BD%94%ED%94%84%EB%B9%88.html)
- [3. 스프링 부트 세션 컴포넌트](/2016/07/20/%EB%B0%B1%EC%97%85-%EA%B0%80%EB%A6%AC%EC%82%AC%EB%8B%88-%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8-%EC%84%B8%EC%85%98-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8.html)


# 서론
이번엔 저번에도 소개한적있는 key-value 데이터베이스 레디스를 스프링세션에 연동하는 강의를 써보도록 하겠습니다.
레디스 소개 : [윈도우에서 Redis (레디스) 설치](/2016/01/27/%EB%B0%B1%EC%97%85-%EA%B0%80%EB%A6%AC%EC%82%AC%EB%8B%88-%EC%9C%88%EB%8F%84%EC%9A%B0%EC%97%90%EC%84%9C-Redis-(%EB%A0%88%EB%94%94%EC%8A%A4)-%EC%84%A4%EC%B9%98.html)


# 레디스 설치
데비안 계열 (우분투등..)
``` shell
> sudo add-apt-repository ppa:chris-lea/redis-server
> sudo apt-get update
> sudo apt-get install redis-server
> sudo vim /etc/redis/redis.conf
```
- vim 을 예제로.. 적당히 설정을 보고 고쳐줍니다.
- 특별히 설정을 하지 않아도 됩니다. -필자도 포트정도만..
윈도우
https://github.com/MSOpenTech/redis/releases
- 다운받아 설치
기타 리눅스/유닉스등..
http://redis.io/download


# 레디스 데스크탑 매니저
레디스 GUI 관리 툴 입니다.
- 설치 : https://redisdesktop.com/
접속해보시면 db0 부터 db15까지 16개의 데이터베이스가 있습니다.


# 메이븐 설정
``` xml
<!-- 스프링 세션 -->
<dependency>
	<groupId>org.springframework.session</groupId>
	<artifactId>spring-session</artifactId>
	<version>1.2.1.RELEASE</version>
</dependency>
<!-- 스프링 레디스 -->
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-redis</artifactId>
</dependency>
```


# properties 설정
필자는 db관련 프로퍼티는 별도로 저장하기 때문에 application.properties 가 아닌
프로젝트/src/main/resources/database.properties 에 저장하였습니다.
``` shell
#레디스
redis.host: 호스트
redis.port: 포트
redis.database: 데이터베이스번호(위 매니저에서봤던 0~15범위내 숫자[데이터베이스번호])
```


# 세션설정
``` java
@Configuration
@EnableRedisHttpSession
@PropertySource("classpath:database.properties")
public class SessionConfig
{
	@Value("${redis.host}")
	String host;

	@Value("${redis.port}")
	int port;

	@Value("${redis.database}")
	int database;

	@Bean
	public JedisConnectionFactory connectionFactory()
	{
		JedisConnectionFactory conn = new JedisConnectionFactory();
		conn.setHostName(host);
		conn.setPort(port);
		conn.setDatabase(database);
		conn.setUsePool(true);
		return conn;
	}

	@Bean
	public CookieSerializer cookieSerializer()
	{
		DefaultCookieSerializer serializer = new DefaultCookieSerializer();
		// 위 레디스 처럼 serializer 의 각종 설정 가능.
		// tomcat context 로 설정한 쿠키 기능들도 여기서 설정가능.
		return serializer;
	}
}
```


# 테스트
세션 스코프빈은 다음 강의에서 할 예정이니 HttpSession 을 사용해보겠습니다.
``` java
@Controller
public class UsingSessionTestController
{
	@ResponseBody
	@RequestMapping(path="/session-test", produces="text/plain")
	public String sessionTest(HttpSession session)
	{
		session.setAttribute("test", "hello");
		return (String)session.getAttribute("test");
	}
}
```
- /session-test 에 접속합니다.
- 레디스 매니저로 조회하여봅니다.
- 해더 Cookie: 와 일치하는 세션아이디가 보이면 성공!